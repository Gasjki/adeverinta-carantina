<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Adeverinta Carantina</title>
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/css/style.css"/>
</head>
<body>
<div class="container" id="app">
    <div class="row my-5">
        <div class="col-12 col-sm-12 col-md-12">
            <div class="card">
                <form>
                    <div class="card-body mb-0">
                        <h5 class="text-center">Declaratie pe proprie raspundere</h5>
                        <div class="table-responsive-md mt-5">
                            <table class="table table-sm d-none d-md-block">
                                <tbody>
                                <tr v-if="users.length">
                                    <td class="align-middle w-25">Datele tale</td>
                                    <td colspan="3" class="align-middle w-75">
                                        <select class="form-control" v-model="selectedUser" v-on:change="loadUser">
                                            <option value="" selected disabled>Alege utilizator</option>
                                            <option v-for="user in users" :value="user.fullName"
                                                    v-text="user.fullName"/>
                                        </select>
                                        <a href="javascript:void(0);" class="small" v-on:click="deleteUser"
                                           v-show="this.selectedUser !== ''">(Sterge
                                            datele pentru utilizatorul curent)</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Subsemnatul</td>
                                    <td colspan="3" class="align-middle w-75"><input type="text" class="form-control"
                                                                                     v-model="fullName" required/></td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Domiciliat în</td>
                                    <td colspan="3" class="align-middle"><input type="text" class="form-control"
                                                                                v-model="resident" required/></td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Cu reședința în</td>
                                    <td colspan="3" class="align-middle">
                                        <input type="text" class="form-control" v-model="residence" required/>
                                        <a href="javascript:void(0);" v-on:click="copyInfoFromResidence" class="small">Copiaza
                                            datele de la domiciliu</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Născut/născută în data de</td>
                                    <td class="align-middle w-25"><input type="date" class="form-control"
                                                                         v-model="birthDate" required/></td>
                                    <td class="align-middle w-25 text-center">în localitatea</td>
                                    <td class="align-middle w-25"><input type="text" class="form-control" v-model="city"
                                                                         required/></td>
                                </tr>
                                </tbody>
                            </table>
                            <table class="table table-sm d-block d-md-none">
                                <tbody>
                                <tr>
                                    <td class="align-middle w-25">Subsemnatul</td>
                                    <td class="align-middle w-75"><input type="text" class="form-control"
                                                                         v-model="fullName" required/></td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Domiciliat în</td>
                                    <td class="align-middle"><input type="text" class="form-control" v-model="resident"
                                                                    required/></td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Cu reședința în</td>
                                    <td class="align-middle"><input type="text" class="form-control" v-model="residence"
                                                                    required/></td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">Născut/născută în data de</td>
                                    <td class="align-middle"><input type="date" class="form-control" v-model="birthDate"
                                                                    required/></td>
                                </tr>
                                <tr>
                                    <td class="align-middle w-25">În localitatea</td>
                                    <td class="align-middle"><input type="text" class="form-control" v-model="city"
                                                                    required/></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive-md mt-3">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td colspan="2">
                                        <h6 class="font-weight-bold">
                                            Declar pe proprie răspundere, cunoscând prevederile articolului 326 din
                                            Codul Penal
                                            privind falsul în declarații, că mă deplasez în afara locuinței, din
                                            următorul motiv:
                                        </h6>
                                    </td>
                                </tr>
                                <tr class="d-none d-md-block">
                                    <td class="align-middle font-weight-bold w-25">1. În intervalul orar</td>
                                    <td class="align-middle"><input type="time" class="form-control d-inline-block"
                                                                    v-model="startingHour" required/></td>
                                    <td class="align-middle"><input type="time" class="form-control d-inline-block"
                                                                    v-model="endingHour" required/></td>
                                </tr>
                                <tr class="d-block d-md-none">
                                    <td class="align-middle font-weight-bold w-25">1. În intervalul orar</td>
                                </tr>
                                <tr class="d-block d-md-none">
                                    <td class="align-middle"><input type="time" class="form-control d-inline-block"
                                                                    v-model="startingHour" required/></td>
                                    <td class="align-middle"> -</td>
                                    <td class="align-middle"><input type="time" class="form-control d-inline-block"
                                                                    v-model="endingHour" required/></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive-md mt-3">
                            <table class="table table-sm">
                                <tbody>
                                <!-- Checkbox #1 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_1"
                                                   v-model="reasons" id="defaultCheck1">
                                            <label class="form-check-label" for="defaultCheck1">
                                                a) deplasarea în interes profesional, inclusiv între locuință,
                                                gospodărie și locul/locurile de desfășurare a activității profesionale
                                                și înapoi;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #2 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_2"
                                                   v-model="reasons" id="defaultCheck2">
                                            <label class="form-check-label" for="defaultCheck2">
                                                b) deplasarea pentru asigurarea de bunuri care acoperă necesitățile de
                                                bază ale persoanelor și animalelor de companie/domestice, precum și
                                                bunuri necesare desfășurării activității profesionale, pentru persoanele
                                                cu vârsta peste 65 de ani în intervalul orar 10:00 - 14:00, iar pentru
                                                persoanele cu vârsta sub 65 de ani, în intervalele orare 06:00 - 10:00,
                                                respectiv 14:00 - 20:00;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #3 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_3"
                                                   v-model="reasons" id="defaultCheck3">
                                            <label class="form-check-label" for="defaultCheck3">
                                                c) deplasarea pentru asistență medicală care nu poate fi amânată și nici
                                                realizată de la distanță;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #4 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_4"
                                                   v-model="reasons" id="defaultCheck4">
                                            <label class="form-check-label" for="defaultCheck4">
                                                d) deplasările scurte, în apropierea locuinței/gospodăriei, legate de
                                                activitatea fizică individuală a persoanelor (cu excluderea oricăror
                                                activități sportive de echipă), cât și pentru nevoile animalelor de
                                                companie/domestice;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #5 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_5"
                                                   v-model="reasons" id="defaultCheck5">
                                            <label class="form-check-label" for="defaultCheck5">
                                                e) deplasarea în scopul donării de sânge, la centrele de transfuzie
                                                sanguină;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #6 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_6"
                                                   v-model="reasons" id="defaultCheck6">
                                            <label class="form-check-label" for="defaultCheck6">
                                                f) deplasarea în scop umanitar sau de voluntariat;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #7 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_7"
                                                   v-model="reasons" id="defaultCheck7">
                                            <label class="form-check-label" for="defaultCheck7">
                                                g) deplasarea pentru realizarea de activități agricole;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #8 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_8"
                                                   v-model="reasons" id="defaultCheck8">
                                            <label class="form-check-label" for="defaultCheck8">
                                                h) deplasarea producătorilor agricoli pentru comercializarea de produse
                                                agroalimentare;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #9 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_9"
                                                   v-model="reasons" id="defaultCheck9">
                                            <label class="form-check-label" for="defaultCheck9">
                                                i) îngrijirea sau administrarea unei proprietăți din alta localitate;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #10 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_10"
                                                   v-model="reasons" id="defaultCheck10">
                                            <label class="form-check-label" for="defaultCheck10">
                                                j) participarea la programe sau proceduri în centrele de tratament;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #11 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_11"
                                                   v-model="reasons" id="defaultCheck11">
                                            <label class="form-check-label" for="defaultCheck11">
                                                k) pentru achiziția, service-ul, efectuarea ITP sau alte operațiuni de
                                                întreținere a vehiculelor;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #12 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_12"
                                                   v-model="reasons" id="defaultCheck12">
                                            <label class="form-check-label" for="defaultCheck12">
                                                l) eliberarea de documente necesare pentru obținerea unor drepturi
                                                prevăzute de lege;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #13 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_13"
                                                   v-model="reasons" id="defaultCheck13">
                                            <label class="form-check-label" for="defaultCheck13">
                                                m) alte motive justificative precum: îngrijirea / însoțirea copiilor /
                                                membrilor de familie, îngrijirea unei rude / afin sau persoană aflată în
                                                întreținere, asistență persoanelor vârstnice, bolnave sau cu
                                                dizabilități ori deces al unui membru de familie;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #14 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_14"
                                                   v-model="reasons" id="defaultCheck14">
                                            <label class="form-check-label" for="defaultCheck14">
                                                n) participarea la activități religioase.
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #15 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_15"
                                                   v-model="reasons" id="defaultCheck15">
                                            <label class="form-check-label" for="defaultCheck15">
                                                o) deplasări ale persoanelor care sunt în tranzit sau efectuează
                                                călătorii al căror interval orar se suprapune cu perioada interdicției,
                                                cum ar fi cele efectuate cu avionul, trenul, autocare sau alte mijloace
                                                de transport de persoane și care poate fi dovedit prin bilet sau orice
                                                altă modalitate de achitare a călătoriei.
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #16 -->
                                <tr>
                                    <td colspan="2" class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_16"
                                                   v-model="reasons" id="defaultCheck16">
                                            <label class="form-check-label" for="defaultCheck16">
                                                p) deplasări ale persoanelor pentru administrare de vaccin împotriva
                                                SARS-CoV-2.
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-justify font-weight-bold small mt-3">
                            În intervalul orar 22.00-06.00, circulația persoanelor în afara locuinței/gospodăriei este
                            permisă numai pentru motivele prevăzute la pct.1, lit.a), c), m) și o).
                        </p>
                        <div class="table-responsive-md mt-3">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td class="align-middle font-weight-bold w-25">2. Intrarea/ieșire în/din localitatea
                                        carantinată
                                    </td>
                                </tr>
                                <!-- Checkbox #1 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_1"
                                                   v-model="extraReasons" id="defaultCheck1b">
                                            <label class="form-check-label" for="defaultCheck1b">
                                                a) transportul de marfă indiferent de natura acestuia, al materiilor
                                                prime și resurselor necesare desfășurării activităților economice în
                                                localitatea carantinată, precum și pentru aprovizionarea populației;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #2 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_2"
                                                   v-model="extraReasons" id="defaultCheck2b">
                                            <label class="form-check-label" for="defaultCheck2b">
                                                b) persoanele care nu locuiesc în zonele carantinate, dar care
                                                desfășoară activități economice sau în domeniul apărării, ordinii
                                                publice, securității naționale, sanitare, veterinare, situațiilor de
                                                urgență, administrație publice, a asistenței și protecției sociale,
                                                judiciare, serviciilor de utilitate publică, agriculturii, comerț și
                                                alimentație publică, comunicațiilor și transporturilor;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #3 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_3"
                                                   v-model="extraReasons" id="defaultCheck3b">
                                            <label class="form-check-label" for="defaultCheck3b">
                                                c) persoanele care locuiesc în zonele carantinate și desfășoară
                                                activitatea profesională în afara zonei carantinate;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #4 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_4"
                                                   v-model="extraReasons" id="defaultCheck4b">
                                            <label class="form-check-label" for="defaultCheck4b">
                                                d) persoanele care realizează activități agricole sau pentru
                                                comercializarea de produse agroalimentare;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #5 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_5"
                                                   v-model="extraReasons" id="defaultCheck5b">
                                            <label class="form-check-label" for="defaultCheck5b">
                                                e) deplasarea din alte motive justificate, precum îngrijirea/însoțirea
                                                copiilor/membrilor de familie, îngrijirea unei/unui rude/afin sau a unei
                                                persoane aflate în întreținere, asistența persoanelor vârstnice, bolnave
                                                sau cu dizabilități, decesul unui membru de familie;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #6 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_6"
                                                   v-model="extraReasons" id="defaultCheck6b">
                                            <label class="form-check-label" for="defaultCheck6b">
                                                f) deplasarea pentru asistență medicală care nu poate fi amânată și nici
                                                realizată de la distanță;
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Checkbox #7 -->
                                <tr>
                                    <td class="align-middle">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="varianta_7"
                                                   v-model="extraReasons" id="defaultCheck7b">
                                            <label class="form-check-label" for="defaultCheck7b">
                                                g) urgențe medicale.
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive-md mt-3">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td class="align-middle w-50 text-center font-weight-bold">Data:</td>
                                </tr>
                                <tr>
                                    <td class="w-50"><input type="date" class="form-control" v-model="date" required/>
                                </tr>
                                <tr>
                                    <td class="align-middle w-50 text-center font-weight-bold">Semnătura:</td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <canvas width="350" height="200" ref="signature"
                                                style="border: 1px solid #e5e5e5"></canvas>
                                        <br/>
                                        <a href="javascript:void(0);" class="small" v-on:click="resetSignature">Reseteaza
                                            semnătura</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row justify-content-center mt-3">
                            <div class="col-12 col-sm-12 col-md-4">
                                <button type="submit" class="btn btn-success btn-block" @click="onClick">
                                    Descarca document
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <button type="submit" class="btn btn-sm btn-success scroll-to-top" :class="{ 'd-none': isButtonFloating }"
                    @click="onClick">
                Descarca document
            </button>
        </div>
    </div>
</div>
<!-- JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/vue-toastr/dist/vue-toastr.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<script src="./assets/js/template.js"></script>
<script type="text/javascript">
    // VueJS
    Vue.use(VueToastr);

    new Vue({
        el: '#app',
        data: {
            // Floating button
            isButtonFloating: false,

            // Errors
            errors: [],

            // Same as variable below (from all sections).
            templateVariables: [
                'fullName',
                'resident',
                'residence',
                'birthDate',
                'city',
                'startingHour',
                'endingHour',
                'reasons',
                'extraReasons',
                'date',
                'signature',
                'reason_1',
                'reason_2',
                'reason_3',
                'reason_4',
                'reason_5',
                'reason_6',
                'reason_7',
                'reason_8',
                'reason_9',
                'reason_10',
                'reason_11',
                'reason_12',
                'reason_13',
                'reason_14',
                'reason_15',
                'reason_16',
                'extra_reason_1',
                'extra_reason_2',
                'extra_reason_3',
                'extra_reason_4',
                'extra_reason_5',
                'extra_reason_6',
                'extra_reason_7'
            ],

            selectedUser: '',
            users: [],

            // Canvas,
            canvas: null,
            signaturePad: null,

            // Section #1
            fullName: null,
            resident: null,
            residence: null,
            birthDate: null,
            city: null,
            startingHour: null,
            endingHour: null,

            // Section #2
            reasons: [],

            // Section #3
            extraReasons: [],
            date: null
        },
        methods: {
            toast: function (type, message) {
                this.$toastr.close = true;
                this.$toastr.debug = false;
                this.$toastr.newestOnTop = true;
                this.$toastr.progressBar = true;
                this.$toastr.positionClass = "toast-top-right";
                this.$toastr.preventDuplicates = false;
                this.$toastr.timeOut = 3000;

                this.$toastr[type](message);
            },
            validate: function () {
                if (!this.validateSectionOne()) {
                    return false;
                }

                if (!this.validateSectionTwo()) {
                    return false;
                }

                return this.validateSectionThree();
            },
            validateSectionOne: function () {
                let errors = false;

                // Validate full name
                if (!this.fullName || !this.fullName.length) {
                    this.toast('e', 'Completeaza campul "Subsemnatul".');
                    errors = true;
                }

                // Validate resident
                if (!this.resident || !this.resident.length) {
                    this.toast('e', 'Completeaza campul "Domiciliat în".');
                    errors = true;
                }

                // Validate residence
                if (!this.residence || !this.residence.length) {
                    this.toast('e', 'Completeaza campul "Cu reședința în".');
                    errors = true;
                }

                // Validate birth date
                if (!this.birthDate || !this.birthDate.length) {
                    this.toast('e', 'Completeaza campul "Născut/născută în data de".');
                    errors = true;
                }

                // Validate city
                if (!this.city || !this.city.length) {
                    this.toast('e', 'Completeaza campul "În localitatea".');
                    errors = true;
                }

                // Validate interval
                if (!this.startingHour || !this.startingHour.length || !this.endingHour || !this.endingHour.length) {
                    this.toast('e', 'Completeaza campurile de la "În intervalul orar".');
                    errors = true;
                }

                return !errors;
            },
            validateSectionTwo: function () {
                let errors = false;

                if (this.reasons.length < 1) {
                    this.toast('e', 'Alege cel putin un motiv pentru care urmeaza sa te deplasezi!');
                    errors = true;
                }

                return !errors;
            },
            validateSectionThree: function () {
                let errors = false;

                // Validate date
                if (!this.date || !this.date.length) {
                    this.toast('e', 'Completeaza campul "Data".');
                    errors = true;
                }

                // Validate signature
                if (this.signaturePad.isEmpty()) {
                    this.toast('e', 'Semneaza documentul!');
                    errors = true;
                }

                return !errors;
            },
            getPreparedTemplateString: function () {
                let regExStr = '{{' + this.templateVariables.join('}}|{{') + '}}';
                const regExpPattern = new RegExp(regExStr, 'gi');
                const checkIcon = '<span style="color: red;">&#9679;</span>';

                let mapObj = {
                    fullName: this.fullName,
                    resident: this.resident,
                    residence: this.residence,
                    birthDate: this.birthDate.split('-').reverse().join('-'),
                    city: this.city,
                    startingHour: this.startingHour,
                    endingHour: this.endingHour,
                    reason_1: this.reasons.includes('varianta_1') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_2: this.reasons.includes('varianta_2') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_3: this.reasons.includes('varianta_3') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_4: this.reasons.includes('varianta_4') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_5: this.reasons.includes('varianta_5') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_6: this.reasons.includes('varianta_6') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_7: this.reasons.includes('varianta_7') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_8: this.reasons.includes('varianta_8') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_9: this.reasons.includes('varianta_9') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_10: this.reasons.includes('varianta_10') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_11: this.reasons.includes('varianta_11') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_12: this.reasons.includes('varianta_12') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_13: this.reasons.includes('varianta_13') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_14: this.reasons.includes('varianta_14') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_15: this.reasons.includes('varianta_15') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    reason_16: this.reasons.includes('varianta_16') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_1: this.extraReasons.includes('varianta_1') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_2: this.extraReasons.includes('varianta_2') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_3: this.extraReasons.includes('varianta_3') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_4: this.extraReasons.includes('varianta_4') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_5: this.extraReasons.includes('varianta_5') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_6: this.extraReasons.includes('varianta_6') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    extra_reason_7: this.extraReasons.includes('varianta_7') ? checkIcon : '&nbsp;&nbsp;&nbsp;',
                    date: this.date.split('-').reverse().join('-'),
                    signature: this.signaturePad.toDataURL()
                };

                templateString = templateString.replace(regExpPattern, function (matched) {
                    let variableName = matched.substring(2, matched.length - 2);
                    return mapObj[variableName] ? mapObj[variableName] : ''
                });

                return templateString;
            },
            generate: function (htmlString) {
                Promise.all(
                    [
                        new Promise(function (resolve) {
                            let iframe = document.createElement('iframe');
                            iframe.id = 'pdfContainer';
                            $('body').append($(iframe));

                            let iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            $('body', $(iframeDoc)).html(htmlString);

                            html2canvas(iframeDoc.body, {
                                onrendered: function (canvas) {
                                    resolve(canvas.toDataURL('image/png', 1));
                                    $(iframe).remove();
                                },
                            });
                        })
                    ])
                    .then(function (templateImage) {
                        let doc = new jsPDF('p', 'mm', [297, 210]);

                        doc.addImage(templateImage[0], 'PNG', 15, 15);
                        const currentDayMonth = (new Date()).toLocaleDateString('ro').replace(/\./g, '_');

                        const fileName = 'declaratie_carantina_' + currentDayMonth + '.pdf';
                        doc.save(fileName);
                    });
            },
            loadUser: function () {
                if (!this.selectedUser) {
                    return;
                }

                let userData = null;

                for (let i = 0; i < this.users.length; i++) {
                    let row = this.users[i];

                    if (row.fullName === this.selectedUser) {
                        userData = this.users[i];
                        break;
                    }
                }

                if (!userData) {
                    return;
                }

                this.fullName = userData.fullName;
                this.resident = userData.resident;
                this.residence = userData.residence;
                this.birthDate = userData.birthDate;
                this.city = userData.city;
                // this.signaturePad.fromDataURL('data:image/png;base64,' + userData.canvas);
            },
            copyInfoFromResidence: function () {
                this.residence = this.resident;
            },
            download: function () {
                this.generate(this.getPreparedTemplateString());
            },
            onClick: function (e) {
                e.preventDefault(); // disable form submit.

                if (!this.validate()) {
                    return;
                }

                this.save();
                this.download();
            },
            resetSignature: function () {
                this.signaturePad.clear();
            },
            save: function () {
                // let canvasBase64 = this.canvas.toDataURL();
                // canvasBase64 = canvasBase64.replace('data:image/png;base64,', '');

                let user = [
                    {
                        'fullName': this.fullName,
                        'resident': this.resident,
                        'residence': this.residence,
                        'birthDate': this.birthDate,
                        'city': this.city,
                        // 'canvas': canvasBase64
                    }
                ];

                if (!this.users.length) {
                    this.users = [user];
                } else {
                    for (let i = 0; i < this.users.length; i++) {
                        let row = this.users[i];

                        if (row.fullName === this.fullName) {
                            this.users.splice(i, 1);
                            break;
                        }
                    }

                    this.users.push(user);
                }

                this.setCookie('users', JSON.stringify(this.users), 1000);
            },
            deleteUser: function () {
                for (let i = 0; i < this.users.length; i++) {
                    let row = this.users[i];

                    if (row.fullName === this.selectedUser) {
                        this.users.splice(i, 1);
                        this.selectedUser = null;
                        break;
                    }
                }

                this.setCookie('users', JSON.stringify(this.users), 1000);
            },
            getCookie: function (cname) {
                let name = cname + "=";
                let decodedCookie = decodeURIComponent(document.cookie);
                let ca = decodedCookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];

                    while (c.charAt(0) === ' ') {
                        c = c.substring(1);
                    }

                    if (c.indexOf(name) === 0) {
                        return c.substring(name.length, c.length);
                    }
                }

                return '';
            },

            setCookie: function (cname, cvalue, exdays) {
                let d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                let expires = "expires=" + d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            },

            // Scroll handler
            scrollHandler: function () {
                const totalScrolled = document.documentElement.scrollTop + window.innerHeight;
                const limit = document.body.clientHeight - 100;

                this.isButtonFloating = totalScrolled > limit;
            },

            // Resize handler
            resizeHandler: function () {
                let ratio = Math.max(window.devicePixelRatio || 1, 1);

                this.canvas.width = this.canvas.offsetWidth * ratio;
                this.canvas.height = this.canvas.offsetHeight * ratio;
                this.canvas.getContext("2d").scale(ratio, ratio);
            }
        },
        mounted() {
            this.canvas = this.$refs.signature;
            this.signaturePad = new SignaturePad(this.canvas);
            let users = this.getCookie('users');
            if (users) {
                users = JSON.parse(users);
                let data = [];

                for (let i = 0; i < users.length; i++) {
                    if (typeof users[i][0] !== "undefined") {
                        data.push(users[i][0]);
                    }
                }

                this.users = data;
            }

            window.addEventListener('scroll', this.scrollHandler);
            window.addEventListener('resize', this.resizeHandler);
        }
    });
</script>
</body>
</html>